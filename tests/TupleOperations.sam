import { Pair, Triple } from std.tuples;
import { ForTests } from tests.StdLib;

class TupleOperations {
  private function testPairCreation(): unit = {
    let p1 = (1, 2);
    let p2 = ("hello", 42);
    let p3 = (true, false);
    let (a, b) = p1;
    ForTests.assertIntEquals(1, a);
    ForTests.assertIntEquals(2, b);
  }

  private function testPairAccess(): unit = {
    let pair = Pair.init(100, "world");
    let { e0, e1 } = pair;
    ForTests.assertIntEquals(100, e0);
    let num = pair.e0;
    let str = pair.e1;
    ForTests.assertIntEquals(100, num);
  }

  private function testTripleCreation(): unit = {
    let t1 = (1, 2, 3);
    let t2 = ("x", "y", "z");
    let t3 = (true, 42, "test");
    let (a, b, c) = t1;
    ForTests.assertIntEquals(1, a);
    ForTests.assertIntEquals(2, b);
    ForTests.assertIntEquals(3, c);
  }

  private function testTripleAccess(): unit = {
    let triple = Triple.init(10, 20, 30);
    let { e0, e1, e2 } = triple;
    ForTests.assertIntEquals(10, e0);
    ForTests.assertIntEquals(20, e1);
    ForTests.assertIntEquals(30, e2);
    let a = triple.e0;
    let b = triple.e1;
    let c = triple.e2;
    ForTests.assertIntEquals(10, a);
    ForTests.assertIntEquals(20, b);
    ForTests.assertIntEquals(30, c);
  }

  private function testNestedTuples(): unit = {
    let nested = ((1, 2), (3, 4));
    let (pair1, pair2) = nested;
    let (a, b) = pair1;
    let (c, d) = pair2;
    ForTests.assertIntEquals(1, a);
    ForTests.assertIntEquals(2, b);
    ForTests.assertIntEquals(3, c);
    ForTests.assertIntEquals(4, d);
  }

  private function makePair(): Pair<int, int> = Pair.init(42, 84)

  private function testTupleReturn(): unit = {
    let pair = TupleOperations.makePair();
    let (x, y) = (pair.e0, pair.e1);
    ForTests.assertIntEquals(42, x);
    ForTests.assertIntEquals(84, y);
  }

  private function swapPair(p: Pair<int, int>): Pair<int, int> = {
    let { e0, e1 } = p;
    Pair.init(e1, e0)
  }

  private function testTupleTransform(): unit = {
    let original = Pair.init(10, 20);
    let swapped = TupleOperations.swapPair(original);
    ForTests.assertIntEquals(20, swapped.e0);
    ForTests.assertIntEquals(10, swapped.e1);
  }

  private function testComplexTuplePattern(): unit = {
    let complex = (1, (2, (3, 4)));
    let (a, (b, (c, d))) = complex;
    ForTests.assertIntEquals(1, a);
    ForTests.assertIntEquals(2, b);
    ForTests.assertIntEquals(3, c);
    ForTests.assertIntEquals(4, d);
  }

  private function testMixedTypeTuples(): unit = {
    let mixed1 = (42, "answer");
    let mixed2 = (true, 100, "test");
    let (num, str) = mixed1;
    let (flag, value, text) = mixed2;
    ForTests.assertIntEquals(42, num);
    ForTests.assertBool(flag, "Flag should be true");
    ForTests.assertIntEquals(100, value)
  }

  function run(): unit = {
    TupleOperations.testPairCreation();
    TupleOperations.testPairAccess();
    TupleOperations.testTripleCreation();
    TupleOperations.testTripleAccess();
    TupleOperations.testNestedTuples();
    TupleOperations.testTupleReturn();
    TupleOperations.testTupleTransform();
    TupleOperations.testComplexTuplePattern();
    TupleOperations.testMixedTypeTuples();
  }
}
