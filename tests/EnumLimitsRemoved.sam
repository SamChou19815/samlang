// Test that enums can exceed the previous 15-variant and 15-field limits
// These would have been rejected before WebAssembly GC support
import { ForTests } from tests.StdLib;

// Enum with 20 variants (previous limit was 15)
class TwentyVariants(
  Va,
  Vb,
  Vc,
  Vd,
  Ve,
  Vf,
  Vg,
  Vh,
  Vi,
  Vj,
  Vk,
  Vl,
  Vm,
  Vn,
  Vo,
  Vp,
  Vq,
  Vr,
  Vs,
  Vt
) {
  method getIndex(): int =
    match this {
      Va -> 1,
      Vb -> 2,
      Vc -> 3,
      Vd -> 4,
      Ve -> 5,
      Vf -> 6,
      Vg -> 7,
      Vh -> 8,
      Vi -> 9,
      Vj -> 10,
      Vk -> 11,
      Vl -> 12,
      Vm -> 13,
      Vn -> 14,
      Vo -> 15,
      Vp -> 16,
      Vq -> 17,
      Vr -> 18,
      Vs -> 19,
      Vt -> 20,
    }
}

// Enum with a variant that has 20 fields (previous limit was 15)
class ManyFields(
  Simple,
  Complex(
    int,
    int,
    int,
    int,
    int,
    int,
    int,
    int,
    int,
    int,
    int,
    int,
    int,
    int,
    int,
    int,
    int,
    int,
    int,
    int
  )
) {
  method sum(): int =
    match this {
      Simple -> 0,
      Complex(
        a,
        b,
        c,
        d,
        e,
        f,
        g,
        h,
        i,
        j,
        k,
        l,
        m,
        n,
        o,
        p,
        q,
        r,
        s,
        t
      ) -> a + b + c + d + e + f + g + h + i + j + k + l + m + n + o + p + q + r + s + t,
    }
}

// Enum with 25 variants (well beyond the old limit of 15)
class TwentyFiveVariants(
  Wa,
  Wb,
  Wc,
  Wd,
  We,
  Wf,
  Wg,
  Wh,
  Wi,
  Wj,
  Wk,
  Wl,
  Wm,
  Wn,
  Wo,
  Wp,
  Wq,
  Wr,
  Ws,
  Wt,
  Wu,
  Wv,
  Ww,
  Wx,
  Wy
) {
  method isEven(): bool =
    match this {
      Wa -> false,
      Wb -> true,
      Wc -> false,
      Wd -> true,
      We -> false,
      Wf -> true,
      Wg -> false,
      Wh -> true,
      Wi -> false,
      Wj -> true,
      Wk -> false,
      Wl -> true,
      Wm -> false,
      Wn -> true,
      Wo -> false,
      Wp -> true,
      Wq -> false,
      Wr -> true,
      Ws -> false,
      Wt -> true,
      Wu -> false,
      Wv -> true,
      Ww -> false,
      Wx -> true,
      Wy -> false,
    }
}

class EnumLimitsRemoved {
  private function testTwentyVariants(): unit = {
    ForTests.assertIntEquals(1, TwentyVariants.Va().getIndex());
    ForTests.assertIntEquals(5, TwentyVariants.Ve().getIndex());
    ForTests.assertIntEquals(10, TwentyVariants.Vj().getIndex());
    ForTests.assertIntEquals(15, TwentyVariants.Vo().getIndex());
    ForTests.assertIntEquals(20, TwentyVariants.Vt().getIndex());
  }

  private function testManyFields(): unit = {
    let simple = ManyFields.Simple();
    ForTests.assertIntEquals(0, simple.sum());
    let complex = ManyFields.Complex(
      1,
      2,
      3,
      4,
      5,
      6,
      7,
      8,
      9,
      10,
      11,
      12,
      13,
      14,
      15,
      16,
      17,
      18,
      19,
      20
    );
    ForTests.assertIntEquals(210, complex.sum());
  }

  private function testTwentyFiveVariants(): unit = {
    ForTests.assertBool(!TwentyFiveVariants.Wa().isEven(), "Wa should be odd");
    ForTests.assertBool(TwentyFiveVariants.Wb().isEven(), "Wb should be even");
    ForTests.assertBool(!TwentyFiveVariants.Wk().isEven(), "Wk should be odd");
    ForTests.assertBool(TwentyFiveVariants.Wl().isEven(), "Wl should be even");
    ForTests.assertBool(!TwentyFiveVariants.Wu().isEven(), "Wu should be odd");
    ForTests.assertBool(TwentyFiveVariants.Wv().isEven(), "Wv should be even");
  }

  function run(): unit = {
    EnumLimitsRemoved.testTwentyVariants();
    EnumLimitsRemoved.testManyFields();
    EnumLimitsRemoved.testTwentyFiveVariants();
  }
}
