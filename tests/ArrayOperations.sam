import { List } from std.list;
import { ForTests } from tests.StdLib;

class ArrayOperations {
  private function testListCreation(): unit = {
    let empty = List.nil<int>();
    let single = List.of(42);
    let multi = List.of(1).cons(2).cons(3);
    ForTests.assertBool(empty.isEmpty(), "Empty list should be empty");
    ForTests.assertBool(!single.isEmpty(), "Single element list should not be empty");
    ForTests.assertBool(!multi.isEmpty(), "Multi element list should not be empty");
  }

  private function testListLength(): unit = {
    let empty = List.nil<int>();
    let single = List.of(42);
    let multi = List.of(1).cons(2).cons(3).cons(4).cons(5);
    ForTests.assertIntEquals(0, empty.length());
    ForTests.assertIntEquals(1, single.length());
    ForTests.assertIntEquals(5, multi.length());
  }

  private function testListMap(): unit = {
    let list = List.of(1).cons(2).cons(3);
    let doubled = list.map((x) -> x * 2);
    ForTests.assertIntEquals(3, doubled.length());
  }

  private function testListFilter(): unit = {
    let list = List.of(1).cons(2).cons(3).cons(4).cons(5).cons(6);
    let evens = list.filter((x) -> x % 2 == 0);
    let greaterThanThree = list.filter((x) -> x > 3);
    ForTests.assertIntEquals(3, evens.length());
    ForTests.assertIntEquals(3, greaterThanThree.length());
  }

  private function testListFold(): unit = {
    let list = List.of(1).cons(2).cons(3).cons(4).cons(5);
    let sum = list.fold((acc, x) -> acc + x, 0);
    let product = list.fold((acc, x) -> acc * x, 1);
    ForTests.assertIntEquals(15, sum);
    ForTests.assertIntEquals(120, product);
  }

  private function testListReverse(): unit = {
    let list = List.of(1).cons(2).cons(3);
    let reversed = list.reverse();
    let head = match reversed {
      Nil -> -1,
      Cons(h, _) -> h,
    };
    ForTests.assertIntEquals(1, head);
  }

  private function testListFirst(): unit = {
    let list = List.of(10).cons(20).cons(30);
    let empty = List.nil<int>();
    let first = list.first();
    let emptyFirst = empty.first();
    match first {
      Some(v) -> ForTests.assertIntEquals(30, v),
      None -> Process.panic<unit>("First element should exist"),
    };
    match emptyFirst {
      Some(_) -> Process.panic<unit>("Empty list should have no first"),
      None -> {  },
    };
  }

  private function testListFind(): unit = {
    let list = List.of(10).cons(20).cons(30);
    let found = list.find((x) -> x == 20);
    let notFound = list.find((x) -> x == 99);
    match found {
      Some(v) -> ForTests.assertIntEquals(20, v),
      None -> Process.panic<unit>("Should find 20"),
    };
    match notFound {
      Some(_) -> Process.panic<unit>("Should not find 99"),
      None -> {  },
    };
  }

  private function testListExists(): unit = {
    let list = List.of(10).cons(20).cons(30);
    ForTests.assertBool(list.exists((x) -> x == 20), "List should contain 20");
    ForTests.assertBool(list.exists((x) -> x == 10), "List should contain 10");
    ForTests.assertBool(!list.exists((x) -> x == 99), "List should not contain 99");
  }

  private function testListForAll(): unit = {
    let list = List.of(2).cons(4).cons(6);
    ForTests.assertBool(list.forAll((x) -> x % 2 == 0), "All elements should be even");
    ForTests.assertBool(!list.forAll((x) -> x > 5), "Not all elements are greater than 5");
  }

  private function testListAppend(): unit = {
    let list1 = List.of(1).cons(2);
    let list2 = List.of(3).cons(4);
    let combined = list1.append(list2);
    ForTests.assertIntEquals(4, combined.length());
  }

  function run(): unit = {
    ArrayOperations.testListCreation();
    ArrayOperations.testListLength();
    ArrayOperations.testListMap();
    ArrayOperations.testListFilter();
    ArrayOperations.testListFold();
    ArrayOperations.testListReverse();
    ArrayOperations.testListFirst();
    ArrayOperations.testListFind();
    ArrayOperations.testListExists();
    ArrayOperations.testListForAll();
    ArrayOperations.testListAppend();
  }
}
