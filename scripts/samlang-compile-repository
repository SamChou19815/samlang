#!/bin/bash

# Fail on any integration test fail.
set -e

EXCLUDE_PATTERN="**/bad.*.sam"

# JS
./samlang-dev -e "$EXCLUDE_PATTERN" compile --target js --output-directory ./out/js

# TS
./samlang-dev -e "$EXCLUDE_PATTERN" compile --target ts --output-directory ./out/ts
echo '{
  "compilerOptions": {
    "rootDir": ".",
    "noEmit": true
  }
}' > ./out/ts/tsconfig.json
echo 'Checking generating TS code...' >&2
tsc -p out/ts/tsconfig.json

# Java
./samlang-dev -e "$EXCLUDE_PATTERN" compile --target java --output-directory ./out/java
echo 'Checking generating Java code...' >&2
javac ./out/java/*.java
rm ./out/java/*.class
